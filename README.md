# API-Articles

Работа сервиса заключается в создании, редактировании, отображении статей пользователей, а также в управлении данными пользователей.
В данном проекте реализованы следующие сущности - пользователь, сессия пользователя, статья.

Особенности проекта:
1. Хранение данных пользователей, сессий и статей осуществлено в таблицах PostgreSQL.
2. Пользователь получает сессию после авторизации, сессия передается в Header`е. Пользователей имеет возможность разлогиниться, его сессия удаляется. Пользователь имеет возможность разлогинить все сессии.
3. Наличие ключа сессии в заголовке запроса позволяет пользователю получить доступ к дополнительному функционалу. Без ключа сессии доступны: просмотр всех пользователей, страница с login, просмотр всех статей и просмотр конкретной статьи по id. 
4. Хеширование паролей пользователей реализовано алгоритмом argon2. К паролю пользователя добавляется случайная соль, позволяющая получить разные хеши при одинаковых паролях.
5. Пользователь имеет возможность поменять свои email, username, пароль, о себе и аватар, реализована проверка на уникальность email и username.
6. Для статей реализована возможность просмотра, добавления, редактирование отдельных элементов (title, body...) и удаления.

# Запуск
1. Запуск приложения в docker-контейнерах:
   * Необходимо выполнить "make containers" в терминале. Будут созданы два контейнера - с базой данных и самим приложением.
     Приложение будет запущено. Для удобства есть команды "make app_on" и "make app_off" для старта и остановки контейнеров, а также "make app_logs" для подключения к bash приложения и просмотра логов.
2. Прямой запуск приложения:
   * Выполнить команду "make db" - создание контейнера с базой данных.
   * Подключиться к базе с помощью команды "db_connect" и в открывшейся оболочке psql выполнить команду "\i ./migration/db_init.sql" для инициализации таблиц.
   * В файле /config/app.env заменить "DB_HOST=host.docker.internal" на "DB_HOST=localhost".
   * Выполнить команду "make run".
  
# USER - отправка и получение данных

* **"/api/users" метод POST** - регистрация пользователя, на вход принимается json:
  ```
  {
    "user": {
        "email": "t@test.ru",
        "username": "test",
        "password": "1234"
    }
  }
  ```

  Указанные поля обязательны. Необязательные поля - "bio", "image".

* **"/api/users/login" метод POST** - аутентификация пользователя, на вход принимается json:
  ```
  {
    "user": {
        "email": "t@test.ru",
        "password": "1234"
    }
  }
  ```

  Указанные поля обязательны, другие поля не требуются. В ответ отсылается json с данными пользователя:

  ```
  {
    "user": {
        "id": 2,
        "email": "t@test.ru",
        "createdAt": "2024-12-24T08:36:13.944944Z",
        "updatedAt": "2024-12-24T08:36:13.944944Z",
        "username": "test",
        "bio": "some information about user",
        "image": "some information about image"
    }
  }
  ```

* **"/api/users/logout" метод GET** - удаление сессии пользователя, для удаления всех сессий пользователя необходимо передать заголовок "DeleteAll = true".
* **"/api/user" метод GET** - получение данных пользователя, id пользователя определяется по ключу сессии. В ответ отправляется json с данными пользователя.
* **"/api/user" метод PUT** - обновление данных пользователя, на вход принимается json:

  ```
  {
    "user": {
        "email": "t@test.ru",
        "username": "test",
        "password": "1234",
        "bio": "some information about user",
        "image": "some information about image"
    }
  }
  ```

  Допускается любая комбинация из этих параметров, для обновления необходим хотя бы один параметр. Email и username должны быть уникальными, password не должен повторять старый пароль.
  В ответ направляется json с обновленными данными.

* **"/api/user" метод DELETE** - удаление пользователя, id пользователя определяется по ключу сессии. При удалении удаляются все статьи и сессии пользователя.
 
  # ARTICLE - отправка и получение данных

* **"/api/articles" метод GET** - получение статей. Доступны query-параметры tag или author, позволяющие отфильтровать все статьи по соответствующему тэгу или автору. В ответ отправляется json со статьями и их количеством.
* **"/api/articles/{id}" метод GET** - получение конкретной статьи по ее id.
* **"/api/article" метод POST** - создание новой статьи. на вход принимается json:

  ```
  {
    "article": {
        "title": "some title",
        "tagList" : ["t","test","some tag"],
        "slug" : "test slug"
    }
  }
  ```

  Поле "title" является обязательным. Необязательные поля - "tagList", "description", "body". Slug формируется транслитирацией по title.
  В ответ направляется id созданной статьи.

* **"/api/article" метод PUT** - обновление данных статьи. на вход принимается json:

  ```
   {
    "article": {
        "id": 1,
        "title": "my title",
        "description": "my description",
        "body": "some text",
        "tagList": ["t","test","some tag"]
    }
  }
  ```

  Поле "id" является обязательным. Допускается любая комбинация указанных полей, для успешного выполнения необходимо отправить хотя бы одно поле помимо "id".
  В овтет отправляется json с обновленными данными:
  
  ```
  {
    "article": {
        "id": 1,
        "author": {
            "ID": 2,
            "Username": "test",
            "Image": "some information about image"
        },
        "title": "my title",
        "slug": "my title",
        "description": "my description",
        "body": "some text",
        "tagList": ["t","test","some tag"],
        "createdAt": "2024-12-24T08:49:33.661818Z",
        "updatedAt": "2024-12-24T08:50:08.111405Z"
    }
  }
  ```

* **"/api/article" метод DELETE** - удаление статьи по id. на вход принимается json:
 
  ```
  {
    "article": {
        "id": 1
    }
  }
  ```
  



